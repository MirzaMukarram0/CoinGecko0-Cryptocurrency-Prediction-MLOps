# Prometheus Alert Rules
# These rules can be used with Alertmanager for advanced alerting

groups:
  - name: crypto_prediction_api
    interval: 30s
    rules:
      # High API Latency Alert
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, rate(api_request_latency_seconds_bucket[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
          service: prediction-api
        annotations:
          summary: "High API latency detected"
          description: "API P95 latency is {{ $value }}s (threshold: 0.5s) for endpoint {{ $labels.endpoint }}"

      # Data Drift Spike Alert
      - alert: DataDriftSpike
        expr: data_drift_ratio > 0.3
        for: 2m
        labels:
          severity: warning
          service: prediction-api
        annotations:
          summary: "Data drift spike detected"
          description: "Data drift ratio is {{ $value }} (30% threshold exceeded) for model {{ $labels.model_type }}"

      # Model Unhealthy Alert
      - alert: ModelUnhealthy
        expr: model_health_status == 0
        for: 1m
        labels:
          severity: critical
          service: prediction-api
        annotations:
          summary: "Model is unhealthy"
          description: "Model {{ $labels.model_type }} is reporting unhealthy status"

      # High Error Rate Alert
      - alert: HighErrorRate
        expr: rate(api_requests_total{status="error"}[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
          service: prediction-api
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors/sec (threshold: 0.1 errors/sec)"

